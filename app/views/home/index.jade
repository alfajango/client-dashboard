extends ../layouts/application

block head
  script
    var socket = io.connect('http://localhost:3000');

    socket.on('serviceResponse', function(data) {
      if (data.redmine) {
        var rows = "";
        $.each(data.redmine, function(i, issue) {
          rows += '<tr>';
          rows += '<td>' + issue.subject + '</td>';
          rows += '<td>' + issue.status + '</td>';
          rows += '<td>' + issue.progress + '</td>';
          rows += '</tr>';
        });
        $('#redmine tbody').html(rows);
      } else if (data.cashboard) {
        var rows = "";
        $.each(data.cashboard, function(i, line_item) {
          rows += '<li>';
          rows += line_item.title;
          rows += ' - ' + line_item.price;
          rows += ' - ' + line_item.complete;
          rows += '</li>';
        });
        $('#cashboard').html(rows);
      } else if (data.errbit) {
        var rows = "";
        $.each(data.errbit, function(i, exception) {
          rows += '<li>';
          rows += exception.title;
          rows += ' - ' + exception.updated;
          rows += ' - ' + exception.env;
          rows += '</li>';
        });
        $('#errbit').html(rows);
      }
    });

  each service in project.services
    script
      socket.emit('service', {client: "#{theClient.id}", project: "#{project.id}", service: "#{service.name}"});

block content
  h1= title
  if admin
    a(href="/admin") Admin
  p Welcome to #{title}

  - if (project.hasService('redmine'))
    h2 Issues
    table#redmine
      thead
        tr
          th Name
          th Status
          th % Done
      tbody
        tr
          td(span='3') Loading...

  - if (project.hasService('errbit'))
    h2 Unresolved Exceptions
    ul#errbit
      li Loading...

  - if (project.hasService('cashboard'))
    h2 Invoice Amount
    ul#cashboard
      li Loading...
